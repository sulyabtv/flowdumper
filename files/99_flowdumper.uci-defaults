#!/bin/sh

# Generate random id for this device
tr -dc A-Za-z0-9 </dev/urandom | head -c 16 > /etc/flowdumper_id

# Set up daily cron job at a random time 0-59 minutes after midnight
min=$(($RANDOM % 60))
grep -sq flowdumper_upload /etc/crontabs/root || \
    echo "${min} 0 * * * /usr/bin/flowdumper_upload.sh" >> /etc/crontabs/root
/etc/init.d/cron reload

exit 0